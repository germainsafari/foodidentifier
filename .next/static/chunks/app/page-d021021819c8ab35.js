(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9065:function(e,r,n){Promise.resolve().then(n.bind(n,5041))},5041:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return c}});var t=n(7437),o=n(2265),a=n(7648);let i=new(n(1548)).$D("AIzaSyBWZhwhmkkR5bUaQyMOaujhQHyDYMna7uQ"),s=e=>new Promise(r=>setTimeout(r,e)),l=e=>({foodName:"Unknown Food",imageUrl:e,countryOfOrigin:"Unknown",description:"Unable to analyze the food image at this time.",nutrition:{calories:0,proteins:0,carbs:0,fats:0,vitamins:[]}}),d=async e=>{try{let r=i.getGenerativeModel({model:"gemini-1.5-flash",generationConfig:{temperature:.4,topP:.8,topK:40}}),n=new FileReader;return new Promise((t,o)=>{n.onloadend=async()=>{let o=n.result,a=null;for(let n=0;n<3;n++)try{n>0&&await s(1e3*n);let l=await r.generateContent({contents:[{role:"user",parts:[{text:'I will provide you with a food image. Please analyze it and return ONLY a JSON object with the following structure:\n            {\n              "foodName": "name of the dish",\n              "countryOfOrigin": "country or culture of origin",\n              "description": "2-3 sentence description of the dish",\n              "nutrition": {\n                "calories": approximate calories per serving as number,\n                "proteins": protein content in grams as number,\n                "carbs": carbohydrate content in grams as number,\n                "fats": fat content in grams as number,\n                "vitamins": ["list of main vitamins present"]\n              }\n            }\n            Ensure all numbers are numeric values, not strings. Do not include any additional text or explanation outside the JSON object.'},{inlineData:{mimeType:e.type,data:o.split(",")[1]}}]}],generationConfig:{maxOutputTokens:1024}}),g=(await l.response).text().trim();try{let e=g.replace(/```json\n?|\n?```/g,"").trim(),r=JSON.parse(e);if(!r.foodName||!r.nutrition)throw Error("Invalid response structure");t({...r,imageUrl:o});return}catch(e){if(console.error("JSON Parse Error:",e,"Raw response:",g),a=e,2===n){var i,d,c,u,m,f,p;let e={foodName:(null===(i=g.match(/"foodName":\s*"([^"]+)"/))||void 0===i?void 0:i[1])||"Unknown Food",countryOfOrigin:(null===(d=g.match(/"countryOfOrigin":\s*"([^"]+)"/))||void 0===d?void 0:d[1])||"Unknown",description:(null===(c=g.match(/"description":\s*"([^"]+)"/))||void 0===c?void 0:c[1])||"No description available",nutrition:{calories:parseInt((null===(u=g.match(/"calories":\s*(\d+)/))||void 0===u?void 0:u[1])||"0"),proteins:parseInt((null===(m=g.match(/"proteins":\s*(\d+)/))||void 0===m?void 0:m[1])||"0"),carbs:parseInt((null===(f=g.match(/"carbs":\s*(\d+)/))||void 0===f?void 0:f[1])||"0"),fats:parseInt((null===(p=g.match(/"fats":\s*(\d+)/))||void 0===p?void 0:p[1])||"0"),vitamins:[]}};t({...e,imageUrl:o,errorMessage:"Failed to parse API response"});return}continue}}catch(e){if(console.error("Attempt ".concat(n+1," failed:"),e),a=e,!1===e.toString().includes("503"))break}console.error("All attempts failed or received non-retryable error:",a),t({...l(o),errorMessage:(null==a?void 0:a.message)||"Unknown error occurred"})},n.onerror=e=>{console.error("FileReader Error:",e),t({...l(""),errorMessage:"Failed to read image file"})},n.readAsDataURL(e)})}catch(e){return console.error("Analyzer Error:",e),{...l(""),errorMessage:"Failed to initialize analyzer"}}};var c=()=>{let[e,r]=(0,o.useState)(""),[n,i]=(0,o.useState)(!1),s=async e=>{var n;let t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(t){i(!0);try{let e=await d(t);r(e.foodName),localStorage.setItem("foodAnalysis",JSON.stringify(e)),"Unknown Food"===e.foodName&&r("Error: Unable to analyze image. Please try again.")}catch(e){console.error("Error analyzing image:",e),r("Error identifying food. Please try again.")}finally{i(!1)}}};return(0,t.jsx)("main",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-r from-purple-500 to-pink-500 p-6",children:(0,t.jsxs)("div",{className:"max-w-4xl w-full bg-white shadow-lg rounded-lg p-6 text-center",children:[(0,t.jsx)("h1",{className:"text-4xl font-extrabold text-gray-900",children:"What's on Your Plate?"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Upload an image of your food and let our AI identify it for you!"}),(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsx)("label",{htmlFor:"upload-button",className:"cursor-pointer inline-flex items-center justify-center px-6 py-3 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold hover:opacity-90 transition",children:n?"Uploading...":"Upload Image"}),(0,t.jsx)("input",{type:"file",id:"upload-button",className:"hidden",accept:"image/*",onChange:s})]}),n&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"})}),e&&!n&&(0,t.jsxs)("div",{className:"mt-6 p-4 bg-gray-100 rounded-lg shadow-md",children:[(0,t.jsxs)("h2",{className:"text-2xl font-semibold text-gray-800",children:["Detected: ",e]}),(0,t.jsx)(a.default,{href:"/results",className:"text-indigo-600 underline mt-2 block",children:"See more details"})]})]})})}}},function(e){e.O(0,[648,548,971,117,744],function(){return e(e.s=9065)}),_N_E=e.O()}]);